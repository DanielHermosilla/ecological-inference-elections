<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute the Expected-Maximization Algorithm — run_em • fastei</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the Expected-Maximization Algorithm — run_em"><meta property="og:description" content="Executes the Expectation-Maximization (EM) algorithm indicating the approximation method to use in the E-step.
It supports both non-covariate and covariate models; the covariate mode is enabled by providing V.
Certain methods may require additional arguments, which can be passed through ... (see fastei-package for more details)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastei</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/covariates.html">Using the covariate approach</a>
    </li>
    <li>
      <a href="../articles/demonstration.html">Demonstration of the package usage</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/DanielHermosilla/ecological-inference-elections/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute the Expected-Maximization Algorithm</h1>
    <small class="dont-index">Source: <a href="https://github.com/DanielHermosilla/ecological-inference-elections/blob/HEAD/R/eim-class.R" class="external-link"><code>R/eim-class.R</code></a></small>
    <div class="hidden name"><code>run_em.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Executes the Expectation-Maximization (EM) algorithm indicating the approximation method to use in the E-step.
It supports both non-covariate and covariate models; the covariate mode is enabled by providing <code>V</code>.
Certain methods may require additional arguments, which can be passed through <code>...</code> (see <a href="fastei-package.html">fastei-package</a> for more details).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_em</span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  W <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  V <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  json_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"mult"</span>,</span>
<span>  initial_prob <span class="op">=</span> <span class="st">"group_proportional"</span>,</span>
<span>  allow_mismatch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  miniter <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  maxtime <span class="op">=</span> <span class="fl">3600</span>,</span>
<span>  param_threshold <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  ll_threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  compute_ll <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  group_agg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mcmc_samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  mcmc_stepsize <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  mvncdf_method <span class="op">=</span> <span class="st">"genz"</span>,</span>
<span>  mvncdf_error <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  mvncdf_samples <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  adjust_prob_cond_method <span class="op">=</span> <span class="st">"project_lp"</span>,</span>
<span>  adjust_prob_cond_every <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxnewton <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  beta_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_factor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>eim</code>, which can be created using the <a href="eim.html">eim</a> function. This parameter should not be used if either (i) <code>X</code> and <code>W</code> matrices or (ii) <code>json_path</code> is supplied. See <strong>Note</strong>.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>(b x c)</code> matrix representing candidate votes per ballot box.</p></dd>


<dt id="arg-w">W<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>A <code>(b x g)</code> matrix representing group votes per ballot box.</p></dd>


<dt id="arg-v">V<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>Optional <code>(b x a)</code> matrix with the attributes for each ballot box. This is only used for parametric models.</p></dd>


<dt id="arg-json-path">json_path<a class="anchor" aria-label="anchor" href="#arg-json-path"></a></dt>
<dd><p>A path to a JSON file containing <code>X</code>, <code>W</code> (and optionally <code>V</code>) fields, stored as nested arrays. It may contain additional fields with other attributes, which will be added to the returned object.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>An optional string specifying the method used for estimating the E-step. Valid
options are:</p><ul><li><p><code>mult</code>: The default method, using a single sum of Multinomial distributions.</p></li>
<li><p><code>mvn_cdf</code>: Uses a Multivariate Normal CDF distribution to approximate the conditional probability.</p></li>
<li><p><code>mvn_pdf</code>: Uses a Multivariate Normal PDF distribution to approximate the conditional probability.</p></li>
<li><p><code>mcmc</code>: Uses MCMC to sample vote outcomes. This is used to estimate the conditional probability of the E-step.</p></li>
<li><p><code>exact</code>: Solves the E-step using the Total Probability Law.</p></li>
</ul><p>When <code>V</code> is supplied (covariate mode), only <code>mult</code> is supported.</p>
<p>For a detailed description of each method, see <a href="fastei-package.html">fastei-package</a> and <strong>References</strong>.</p></dd>


<dt id="arg-initial-prob">initial_prob<a class="anchor" aria-label="anchor" href="#arg-initial-prob"></a></dt>
<dd><p>An optional string specifying the method used to obtain the initial
probability. Accepted values are:</p><ul><li><p><code>uniform</code>: Assigns equal probability to every candidate within each group.</p></li>
<li><p><code>proportional</code>: Assigns probabilities to each group based on the proportion of candidates votes.</p></li>
<li><p><code>group_proportional</code>: Computes the probability matrix by taking into account both group and candidate proportions. This is the default method.</p></li>
<li><p><code>random</code>: Use randomized values to fill the probability matrix.
This argument is ignored if <code>V</code> is supplied (covariate mode), as the initial probabilities are computed with <code>alpha_init</code> and <code>beta_init</code>.</p></li>
</ul></dd>


<dt id="arg-allow-mismatch">allow_mismatch<a class="anchor" aria-label="anchor" href="#arg-allow-mismatch"></a></dt>
<dd><p>Boolean, if <code>TRUE</code>, allows a mismatch between the voters and votes for each ballot-box. If <code>FALSE</code>, throws an error if there is a mismatch. By default it is <code>TRUE</code>. See <strong>Notes</strong> for more details.</p></dd>


<dt id="arg-maxiter">maxiter<a class="anchor" aria-label="anchor" href="#arg-maxiter"></a></dt>
<dd><p>An optional integer indicating the maximum number of EM iterations.
The default value is <code>1000</code>.</p></dd>


<dt id="arg-miniter">miniter<a class="anchor" aria-label="anchor" href="#arg-miniter"></a></dt>
<dd><p>An optional integer indicating the minimum number of EM iterations. The default value is <code>0</code>.</p></dd>


<dt id="arg-maxtime">maxtime<a class="anchor" aria-label="anchor" href="#arg-maxtime"></a></dt>
<dd><p>An optional numeric specifying the maximum running time (in seconds) for the
algorithm. This is checked at every iteration of the EM algorithm. The default value is <code>3600</code>, which corresponds to an hour.</p></dd>


<dt id="arg-param-threshold">param_threshold<a class="anchor" aria-label="anchor" href="#arg-param-threshold"></a></dt>
<dd><p>An optional numeric value indicating the minimum difference between
consecutive probability values required to stop iterating. The default value is <code>0.001</code>. Note that the algorithm will stop if either <code>ll_threshold</code> <strong>or</strong> <code>param_threshold</code> is accomplished.</p></dd>


<dt id="arg-ll-threshold">ll_threshold<a class="anchor" aria-label="anchor" href="#arg-ll-threshold"></a></dt>
<dd><p>An optional numeric value indicating the minimum difference between consecutive log-likelihood values to stop iterating. The default value is <code>inf</code>, essentially deactivating
the threshold. Note that the algorithm will stop if either <code>ll_threshold</code> <strong>or</strong> <code>param_threshold</code> is accomplished.</p></dd>


<dt id="arg-compute-ll">compute_ll<a class="anchor" aria-label="anchor" href="#arg-compute-ll"></a></dt>
<dd><p>An optional boolean indicating whether to compute the log-likelihood at each iteration. The default value is <code>TRUE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional integer indicating the random seed for the randomized algorithms. This argument is only applicable if <code>initial_prob = "random"</code> or <code>method</code> is either <code>"mcmc"</code> or <code>"mvn_cdf"</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>An optional boolean indicating whether to print informational messages during the EM
iterations. The default value is <code>FALSE</code>.</p></dd>


<dt id="arg-group-agg">group_agg<a class="anchor" aria-label="anchor" href="#arg-group-agg"></a></dt>
<dd><p>An optional vector of increasing integers from 1 to the number of columns in <code>W</code>, specifying how to aggregate groups in <code>W</code> before running the EM algorithm. Each value represents the highest column index included in each aggregated group. For example, if <code>W</code> has four columns, <code>group_agg = c(2, 4)</code> indicates that columns 1 and 2 should be combined into one group, and columns 3 and 4 into another. Defaults to <code>NULL</code>, in which case no group aggregation is performed.</p></dd>


<dt id="arg-mcmc-samples">mcmc_samples<a class="anchor" aria-label="anchor" href="#arg-mcmc-samples"></a></dt>
<dd><p>An optional integer indicating the number of samples to generate for the
<strong>MCMC</strong> method. This parameter is only relevant when <code>method = "mcmc"</code>.
The default value is <code>1000</code>.</p></dd>


<dt id="arg-mcmc-stepsize">mcmc_stepsize<a class="anchor" aria-label="anchor" href="#arg-mcmc-stepsize"></a></dt>
<dd><p>An optional integer specifying the step size for the <code>mcmc</code>
algorithm. This parameter is only applicable when <code>method = "mcmc"</code> and will
be ignored otherwise. The default value is <code>3000</code>.</p></dd>


<dt id="arg-mvncdf-method">mvncdf_method<a class="anchor" aria-label="anchor" href="#arg-mvncdf-method"></a></dt>
<dd><p>An optional string specifying the method used to estimate the <code>mvn_cdf</code> method
via a Monte Carlo simulation. Accepted values are <code>genz</code> and <code>genz2</code>, with <code>genz</code>
set as the default. This parameter is only applicable when <code>method = "mvn_cdf"</code>. See <strong>References</strong> for more details.</p></dd>


<dt id="arg-mvncdf-error">mvncdf_error<a class="anchor" aria-label="anchor" href="#arg-mvncdf-error"></a></dt>
<dd><p>An optional numeric value defining the error threshold for the Monte Carlo
simulation when estimating the <code>mvn_cdf</code> method. The default value is <code>1e-6</code>. This parameter is only relevant
when <code>method = "mvn_cdf"</code>.</p></dd>


<dt id="arg-mvncdf-samples">mvncdf_samples<a class="anchor" aria-label="anchor" href="#arg-mvncdf-samples"></a></dt>
<dd><p>An optional integer specifying the number of Monte Carlo
samples for the <code>mvn_cdf</code> method. The default value is <code>5000</code>. This argument is only applicable when <code>method = "mvn_cdf"</code>.</p></dd>


<dt id="arg-adjust-prob-cond-method">adjust_prob_cond_method<a class="anchor" aria-label="anchor" href="#arg-adjust-prob-cond-method"></a></dt>
<dd><p>An optional string indicating the method to adjust the conditional probability so that for each candidate, the sum product of voters and conditional probabilities across groups equals the votes obtained by the candidate. It can take values: <code>""</code> if no adjusting is made, <code>"lp"</code> if the adjustment is based on a linear programming that penalizes with L1-norm, <code>"project_lp"</code> if the adjustment is performed using projection and linear programming (this is the default)</p></dd>


<dt id="arg-adjust-prob-cond-every">adjust_prob_cond_every<a class="anchor" aria-label="anchor" href="#arg-adjust-prob-cond-every"></a></dt>
<dd><p>An optional boolean indicating whether to adjust the conditional probability on every iteration (if <code>TRUE</code>), or only at the conditional probabilities obtained at the end of the EM algorithm (if <code>FALSE</code>, this is the default). This parameter applies only if <code>adjust_prob_conditional_method</code> is <code>lp</code> or <code>project_lp</code>.</p></dd>


<dt id="arg-maxnewton">maxnewton<a class="anchor" aria-label="anchor" href="#arg-maxnewton"></a></dt>
<dd><p>Maximum number of Newton iterations used in the parametric M-step. Default is 1. Ignored if no covariates are provided (i.e., <code>V = NULL</code>).</p></dd>


<dt id="arg-beta-init">beta_init<a class="anchor" aria-label="anchor" href="#arg-beta-init"></a></dt>
<dd><p>Optional <code>g x (c-1)</code> matrix of initial group coefficients. Ignored if no covariates are provided (i.e., <code>V = NULL</code>).</p></dd>


<dt id="arg-alpha-init">alpha_init<a class="anchor" aria-label="anchor" href="#arg-alpha-init"></a></dt>
<dd><p>Optional <code>(c-1) x a</code> matrix of initial attribute coefficients used for initialization. Ignored if no covariates are provided (<code>V = NULL</code>).</p></dd>


<dt id="arg-scale-factor">scale_factor<a class="anchor" aria-label="anchor" href="#arg-scale-factor"></a></dt>
<dd><p>An optional numeric value used to scale down the <code>X</code> and <code>W</code> matrices before executing the EM algorithm. This scaling can help improve performance when dealing with large vote counts. For example if <code>scale_factor = 2</code> all elements of <code>X</code> and <code>W</code> are divided by two and rounded. The default value is <code>1</code>, which means no scaling is applied. In case the scaling results in mismatch between <code>W</code> and <code>X</code>, ensure that <code>allow_mismatch = TRUE</code>.</p></dd>


<dt id="arg-symmetric">symmetric<a class="anchor" aria-label="anchor" href="#arg-symmetric"></a></dt>
<dd><p>A boolean indicating whether to perform a symmetric estimation. If <code>TRUE</code>, the algorithm runs twice: first estimating the probabilities of candidates given groups, and then estimating the probabilities of groups given candidates. The final probabilities are obtained by averaging the expected outcomes from both runs. This approach can provide a more balanced estimation in certain scenarios. The default value is <code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Added for compability</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The function returns an <code>eim</code> object with the function arguments and the following attributes:</p><dl><dt>prob</dt>
<dd><p>If <code>V</code> is <code>NULL</code> (non-covariate), the estimated global probability matrix <code>(g x c)</code>.
If <code>V</code> is supplied (covariates), a <code>(g x c x b)</code> 3d-array of probabilities for each ballot-box.</p></dd>

<dt>cond_prob</dt>
<dd><p>A <code>(g x c x b)</code> 3d-array with the probability that at each ballot-box a voter of each group voted for each candidate,
given the observed outcome at the particular ballot-box.</p></dd>

<dt>expected_outcome</dt>
<dd><p>A <code>(g x c x b)</code> 3d-array with the expected votes cast for each ballot-box.</p></dd>

<dt>logLik</dt>
<dd><p>The log-likelihood value from the last iteration.</p></dd>

<dt>iterations</dt>
<dd><p>The total number of iterations performed by the EM algorithm.</p></dd>

<dt>time</dt>
<dd><p>The total execution time of the algorithm in seconds.</p></dd>

<dt>status</dt>
<dd><p>The final status ID of the algorithm upon completion:</p><ul><li><p><code>0</code>: Converged</p></li>
<li><p><code>1</code>: Maximum time reached.</p></li>
<li><p><code>2</code>: Maximum iterations reached.</p></li>
</ul></dd>

<dt>message</dt>
<dd><p>The finishing status displayed as a message, matching the status ID value.</p></dd>

<dt>method</dt>
<dd><p>The method for estimating the conditional probability in the E-step.</p></dd>


</dl><p>Aditionally, it will create <code>mcmc_samples</code> and <code>mcmc_stepsize</code> parameters if the specified <code>method = "mcmc"</code>, or <code>mvncdf_method</code>, <code>mvncdf_error</code> and <code>mvncdf_samples</code> if <code>method = "mvn_cdf"</code>.</p>
<p>Also, if the eim object supplied is created with the function <a href="simulate_election.html">simulate_election</a>, it also returns the real probability and unobserved votes with the name <code>real_prob</code> and <code>outcome</code> respectively. See <a href="simulate_election.html">simulate_election</a>.</p>
<p>If <code>group_agg</code> is different than <code>NULL</code>, two values are returned: <code>W_agg</code> a <code>(b x a)</code> matrix with the number of voters of each aggregated group o each ballot-box, and <code>group_agg</code> the same input vector.</p>
<p>Furthermore, if <code>symmetric = TRUE</code>, the following additional attributes are included:</p><dl><dt>prob_inv</dt>
<dd><p>The estimated probability matrix <code>(c x g)</code>, obtained by swapping <code>X</code> and <code>W</code>.</p></dd>

<dt>cond_prob_inv</dt>
<dd><p>A <code>(c x g x b)</code> 3d-array with the probability that at each ballot-box a voter of each candidate voted for each group, given the observed outcome at the particular ballot-box.</p></dd>


</dl><p>Under this argument, the conditional probabilities will be obtained by dividing new expected outcomes by <code>W</code>. The probabilities will be calculated by performing an M-step.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>This function can be executed using one of three mutually exclusive approaches:</p><ol><li><p>By providing an existing <code>eim</code> object.</p></li>
<li><p>By supplying both input matrices (<code>X</code> and <code>W</code>) directly.</p></li>
<li><p>By specifying a JSON file (<code>json_path</code>) containing the matrices.</p></li>
</ol><p>These input methods are <strong>mutually exclusive</strong>, meaning that you must provide <strong>exactly one</strong> of
these options. Attempting to provide more than one or none of these inputs will result in an error.</p>
<p>When called with an <code>eim</code> object, the function updates the object with the computed results.
If an <code>eim</code> object is not provided, the function will create one internally using either the
supplied matrices or the data from the JSON file before executing the algorithm.</p>
<p>If there are ballot-boxes with mismatch between <code>W</code> and <code>X</code>, and <code>allow_mismatch = TRUE</code>, then: if <code>method = "exact"</code>, at each ballot-box with mismatch D'Hont is applied to add or remove the necessary voters from (<code>W</code>) so that its total match the total number of votes (<code>X</code>); if method is "<code>mvn_pdf</code>", "<code>mvn_cdf</code>" or "<code>mcmc</code>", the number of voters (<code>W</code>) of the ballot-box with mismatch is scaled to match its total number of votes (<code>X</code>).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p><a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4832834" class="external-link">Thraves, C., Ubilla, P. and Hermosilla, D.: <em>"Fast Ecological Inference Algorithm for the RxC Case"</em></a>. Aditionally, the MVN CDF is computed by the methods introduced in <a href="https://www.researchgate.net/publication/2463953_Numerical_Computation_Of_Multivariate_Normal_Probabilities" class="external-link">Genz, A. (2000). Numerical computation of multivariate normal probabilities. <em>Journal of Computational and Graphical Statistics</em></a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The <a href="eim.html">eim</a> object implementation.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Compute the Expected-Maximization with default settings</span></span></span>
<span class="r-in"><span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_election.html">simulate_election</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    num_ballots <span class="op">=</span> <span class="fl">300</span>,</span></span>
<span class="r-in"><span>    num_candidates <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    num_groups <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="eim.html">eim</a></span><span class="op">(</span><span class="va">simulations</span><span class="op">$</span><span class="va">X</span>, <span class="va">simulations</span><span class="op">$</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">run_em</span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="co"># Returns the object with updated attributes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Compute the Expected-Maximization using the mvn_pdf method</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">run_em</span><span class="op">(</span></span></span>
<span class="r-in"><span>    object <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>    method <span class="op">=</span> <span class="st">"mvn_pdf"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Run the mvn_cdf method with default settings</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">run_em</span><span class="op">(</span>object <span class="op">=</span> <span class="va">model</span>, method <span class="op">=</span> <span class="st">"mvn_cdf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example 4: Perform an Exact estimation using user-defined parameters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">run_em</span><span class="op">(</span></span></span>
<span class="r-in"><span>    json_path <span class="op">=</span> <span class="st">"a/json/file.json"</span>,</span></span>
<span class="r-in"><span>    method <span class="op">=</span> <span class="st">"exact"</span>,</span></span>
<span class="r-in"><span>    initial_prob <span class="op">=</span> <span class="st">"uniform"</span>,</span></span>
<span class="r-in"><span>    maxiter <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    maxtime <span class="op">=</span> <span class="fl">600</span>,</span></span>
<span class="r-in"><span>    param_threshold <span class="op">=</span> <span class="fl">1e-3</span>,</span></span>
<span class="r-in"><span>    ll_threshold <span class="op">=</span> <span class="fl">1e-5</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Charles Thraves, Pablo Ubilla, Daniel Hermosilla.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

