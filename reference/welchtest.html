<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Performs a matrix-wise Welch's t-test for two eim objects — welchtest • fastei</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performs a matrix-wise Welch's t-test for two eim objects — welchtest"><meta name="description" content="This function compares two eim objects (or sets of matrices that can be converted to such objects) by computing a Welch's t-test on each component
of their estimated probability matrices (p). The Welch test is applied using bootstrap-derived standard deviations, and the result is a matrix
of p-values corresponding to each group-candidate combination."><meta property="og:description" content="This function compares two eim objects (or sets of matrices that can be converted to such objects) by computing a Welch's t-test on each component
of their estimated probability matrices (p). The Welch test is applied using bootstrap-derived standard deviations, and the result is a matrix
of p-values corresponding to each group-candidate combination."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fastei</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="external-link nav-link" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4832834">Paper</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-functions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Functions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-functions"><li><a class="dropdown-item" href="../reference/run_em.html">run_em()</a></li>
    <li><a class="dropdown-item" href="../reference/bootstrap.html">bootstrap()</a></li>
    <li><a class="dropdown-item" href="../reference/simulate_election.html">simulate_election()</a></li>
    <li><a class="dropdown-item" href="../reference/get_agg_opt.html">get_agg_opt()</a></li>
    <li><a class="dropdown-item" href="../reference/get_agg_proxy.html">get_agg_proxy()</a></li>
    <li><a class="dropdown-item" href="../reference/welchtest.html">welchtest()</a></li>
    <li><a class="dropdown-item" href="../reference/get_XW_chile.html">get_XW_chile()</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Index</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DanielHermosilla/ecological-inference-elections/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Performs a matrix-wise Welch's t-test for two eim objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/DanielHermosilla/ecological-inference-elections/blob/HEAD/R/eim-class.R" class="external-link"><code>R/eim-class.R</code></a></small>
      <div class="d-none name"><code>welchtest.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function compares two <code>eim</code> objects (or sets of matrices that can be converted to such objects) by computing a Welch's t-test on each component
of their estimated probability matrices (<code>p</code>). The Welch test is applied using bootstrap-derived standard deviations, and the result is a matrix
of p-values corresponding to each group-candidate combination.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">welchtest</span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  object2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  W <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  W2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"two.sided"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An <code>eim</code> object, as returned by <a href="eim.html">eim</a>.</p></dd>


<dt id="arg-object-">object2<a class="anchor" aria-label="anchor" href="#arg-object-"></a></dt>
<dd><p>A second <code>eim</code> object to compare with <code>object</code>.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>(b x c)</code> matrix representing candidate votes per ballot box.</p></dd>


<dt id="arg-w">W<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>A <code>(b x g)</code> matrix representing group votes per ballot box.</p></dd>


<dt id="arg-x-">X2<a class="anchor" aria-label="anchor" href="#arg-x-"></a></dt>
<dd><p>A second <code>(b x c)</code> matrix to compare with <code>X</code>.</p></dd>


<dt id="arg-w-">W2<a class="anchor" aria-label="anchor" href="#arg-w-"></a></dt>
<dd><p>A second <code>(b x g)</code> matrix to compare with <code>W</code>.</p></dd>


<dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>Integer specifying how many times to run the EM algorithm per object.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional integer indicating the random seed for the randomized algorithms. This argument is only applicable if <code>initial_prob = "random"</code> or <code>method</code> is either <code>"mcmc"</code> or <code>"mvn_cdf"</code>. Aditionally, it sets the random draws of the ballot boxes.</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>Character string specifying the type of alternative hypothesis to test. Must be one of <code>"two.sided"</code> (default), <code>"greater"</code>, or <code>"less"</code>. If <code>"two.sided"</code>, the test checks for any difference in estimated probabilities. If <code>"greater"</code>, it tests whether the first object has systematically higher probabilities than the second. If <code>"less"</code>, it tests whether the first has systematically lower probabilities.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <a href="bootstrap.html">bootstrap</a> and <a href="run_em.html">run_em</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with components:</p><ul><li><p><code>pvals</code>: a numeric matrix of p-values with the same dimensions as the estimated probability matrices (<code>pvals</code>) from the input objects.</p></li>
<li><p><code>statistic</code>: a numeric matrix of t-statistics with the same dimensions as the estimated probability matrices (<code>pvals</code>).</p></li>
<li><p><code>eim1</code> and <code>eim2</code>: the original <code>eim</code> objects used for comparison.</p></li>
</ul><p>Each entry in the pvals matrix is the p-value from Welch's t-test between the corresponding
entries of the two estimated probability matrices.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>It uses Welch's t-test to analyze if there is a significant difference between the estimated probabilities between a treatment and a control set. The test is performed independently for each component of the probability matrix.</p>
<p>The user must provide either of the following (but not both):</p><ul><li><p>Two <code>eim</code> objects via <code>object</code> and <code>object2</code>, or</p></li>
<li><p>Four matrices: <code>X</code>, <code>W</code>, <code>X2</code>, and <code>W2</code>, which will be converted into <code>eim</code> objects internally.</p></li>
</ul><p>The Welch test is computed using the formula:</p>
<p>$$
t_{ij} = \frac{p_{1,ij} - p_{2,ij}}{\sqrt{(s_{1,ij}^2 + s_{2,ij}^2) / n}},
$$
In this expression, \(s_{1,ij}^2\) and \(s_{2,ij}^2\) represent the bootstrap sample variances for the treatment and control sets, respectively, while \(p_{1,ij}\) and \(p_{2,ij}\) are the corresponding estimated probability matrices obtained via the EM algorithm. The number of bootstrap samples is denoted by \(n\), and the degrees of freedom for each component are calculated using the Welch-Satterthwaite equation</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_election.html">simulate_election</a></span><span class="op">(</span>num_ballots <span class="op">=</span> <span class="fl">100</span>, num_candidates <span class="op">=</span> <span class="fl">3</span>, num_groups <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_election.html">simulate_election</a></span><span class="op">(</span>num_ballots <span class="op">=</span> <span class="fl">100</span>, num_candidates <span class="op">=</span> <span class="fl">3</span>, num_groups <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">124</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="eim.html">eim</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">X</span>, <span class="va">sim</span><span class="op">$</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="eim.html">eim</a></span><span class="op">(</span><span class="va">sim2</span><span class="op">$</span><span class="va">X</span>, <span class="va">sim2</span><span class="op">$</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">welchtest</span><span class="op">(</span>object <span class="op">=</span> <span class="va">eim1</span>, object2 <span class="op">=</span> <span class="va">eim2</span>, nboot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check which entries are significantly different</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">pvals</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       row col</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]   1   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]   2   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]   3   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]   4   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]   5   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]   1   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]   2   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]   3   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]   4   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]   1   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]   3   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,]   4   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]   5   3</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>fastei</p>
</div>

<div class="pkgdown-footer-right">
  <p>Developed by Daniel Hermosilla.</p>
</div>

    </footer></div>





  </body></html>

