<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Demonstration of the package usage • fastei</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Demonstration of the package usage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fastei</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4832834">Paper</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-functions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Functions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-functions">
<li><a class="dropdown-item" href="../reference/run_em.html">run_em()</a></li>
    <li><a class="dropdown-item" href="../reference/bootstrap.html">bootstrap()</a></li>
    <li><a class="dropdown-item" href="../reference/simulate_election.html">simulate_election()</a></li>
    <li><a class="dropdown-item" href="../reference/get_agg_opt.html">get_agg_opt()</a></li>
    <li><a class="dropdown-item" href="../reference/get_agg_proxy.html">get_agg_proxy()</a></li>
    <li><a class="dropdown-item" href="../reference/welchtest.html">welchtest()</a></li>
    <li><a class="dropdown-item" href="../reference/get_XW_chile.html">get_XW_chile()</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Index</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DanielHermosilla/ecological-inference-elections/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Demonstration of the package usage</h1>
                        <h4 data-toc-skip class="author">Daniel
Hermosilla</h4>
            
            <h4 data-toc-skip class="date">2025-04-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DanielHermosilla/ecological-inference-elections/blob/HEAD/vignettes/demonstration.Rmd" class="external-link"><code>vignettes/demonstration.Rmd</code></a></small>
      <div class="d-none name"><code>demonstration.Rmd</code></div>
    </div>

    
    
<p>The <code>fastei</code> library implements the
Expectation-Maximization algorithm to estimate probabilities in
non-parametric Ecological Inference for the RxC case. It offers both an
exact method and four approximation methods suitable for large datasets.
The application demonstrated here is based on an electoral context
where, for each ballot box, we know the number of voters in each
demographic group and the number of votes received by each
candidate.</p>
<div class="section level2">
<h2 id="estimate-voting-probabilities">Estimate Voting Probabilities<a class="anchor" aria-label="anchor" href="#estimate-voting-probabilities"></a>
</h2>
<p>We use data from the First Round of the Chilean Presidential Election
of 2021, where at each ballot box we have the voters of eight age ranges
(groups), and candidate votes obtained. The function
<code><a href="../reference/get_XW_chile.html">get_XW_chile()</a></code> loads this data at either the country,
region, or electoral district level.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://danielhermosilla.github.io/ecological-inference-elections/reference/fastei-package.html">fastei</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">apoquindo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_XW_chile.html">get_XW_chile</a></span><span class="op">(</span>elect_district <span class="op">=</span> <span class="st">"APOQUINDO"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">apoquindo</span></span></code></pre></div>
<pre><code><span><span class="co">## eim ecological inference model</span></span>
<span><span class="co">## Candidates' vote matrix (X) [b x c]:</span></span>
<span><span class="co">##     C1  C2 C3 C4 C5 C6 C7 C8</span></span>
<span><span class="co">## 37M 36  91 19 48  2  7  2  5</span></span>
<span><span class="co">## 38M 29 103 17 54  1  6  3  3</span></span>
<span><span class="co">## 40M 25  95 21 38  3  4  2  2</span></span>
<span><span class="co">## 41M 31  86 19 48  0  4  5  2</span></span>
<span><span class="co">## 43M 28  76 16 66  1  2  0  1</span></span>
<span><span class="co">## .</span></span>
<span><span class="co">## .</span></span>
<span><span class="co">## .</span></span>
<span><span class="co">## Group-level voter matrix (W) [b x g]:</span></span>
<span><span class="co">##     X18.19 X20.29 X30.39 X40.49 X50.59 X60.69 X70.79 X80.</span></span>
<span><span class="co">## 37M      5     27     11     50     23     39     36   19</span></span>
<span><span class="co">## 38M      5     33     11     48     22     42     36   19</span></span>
<span><span class="co">## 40M      6     21      6     49     36     20     29   23</span></span>
<span><span class="co">## 41M      3     27      6     55     23     29     33   19</span></span>
<span><span class="co">## 43M      4     22      8     58     26     32     28   12</span></span>
<span><span class="co">## .</span></span>
<span><span class="co">## .</span></span>
<span><span class="co">## .</span></span></code></pre>
<p>As shown in the output, it returns an eim object that contains two
matrices: the number of votes per candidate and the number of votes per
group. The rows of both matrices correspond to the specific ballot-box,
and the columns are candidates and groups, respectively. This eim object
is used as input to run the EM algorithm that estimates the voting
probabilities. In this example, it uses the default method
<code>mult</code>, which is the most efficient in terms of runtime.
Running the algorithm is as simple as calling <code><a href="../reference/run_em.html">run_em()</a></code>. The
most efficient method tends to be “mult”:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_em.html">run_em</a></span><span class="op">(</span><span class="va">apoquindo</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">prob</span></span></code></pre></div>
<pre><code><span><span class="co">##                C1        C2         C3        C4           C5          C6</span></span>
<span><span class="co">## X18.19 0.18065151 0.3769887 0.08609561 0.3228505 0.0116633635 0.017520279</span></span>
<span><span class="co">## X20.29 0.20288189 0.3453684 0.04348590 0.3453619 0.0074515610 0.018659913</span></span>
<span><span class="co">## X30.39 0.16148597 0.4074162 0.04256031 0.3584222 0.0028040941 0.006642256</span></span>
<span><span class="co">## X40.49 0.09194612 0.4908708 0.07696848 0.3272220 0.0027235255 0.003147865</span></span>
<span><span class="co">## X50.59 0.15442068 0.4082031 0.09803601 0.2842914 0.0006296714 0.036160740</span></span>
<span><span class="co">## X60.69 0.09770731 0.5062656 0.09138068 0.2687257 0.0021351990 0.023742264</span></span>
<span><span class="co">## X70.79 0.10547464 0.5303769 0.08441581 0.2317909 0.0041415730 0.018717650</span></span>
<span><span class="co">## X80.   0.07254167 0.5065080 0.13750067 0.2327520 0.0099251090 0.022975509</span></span>
<span><span class="co">##                 C7           C8</span></span>
<span><span class="co">## X18.19 0.003981122 0.0002489339</span></span>
<span><span class="co">## X20.29 0.019823303 0.0169670846</span></span>
<span><span class="co">## X30.39 0.017852624 0.0028163233</span></span>
<span><span class="co">## X40.49 0.002094378 0.0050268188</span></span>
<span><span class="co">## X50.59 0.016133183 0.0021252418</span></span>
<span><span class="co">## X60.69 0.007540262 0.0025030014</span></span>
<span><span class="co">## X70.79 0.016452401 0.0086301151</span></span>
<span><span class="co">## X80.   0.007744594 0.0100524395</span></span></code></pre>
<p>Note that each row corresponds to the probability that a demographic
group (<code>g</code>) voted for a candidate (<code>c</code>). It is
worth noting how the results differ substantially across groups.</p>
</div>
<div class="section level2">
<h2 id="standard-deviation-estimates">Standard deviation estimates<a class="anchor" aria-label="anchor" href="#standard-deviation-estimates"></a>
</h2>
<p>We can compute the standard deviation of the estimated probabilities
using bootstrapping. This can be done with the function
<code><a href="../reference/bootstrap.html">bootstrap()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">results</span>, seed <span class="op">=</span> <span class="fl">42</span>, nboot <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">sd</span></span></code></pre></div>
<pre><code><span><span class="co">##                C1         C2         C3         C4         C5         C6</span></span>
<span><span class="co">## X18.19 0.10015206 0.13067346 0.04959047 0.07686245 0.04110860 0.03774454</span></span>
<span><span class="co">## X20.29 0.08706027 0.10416220 0.04925448 0.06169626 0.02974504 0.04220625</span></span>
<span><span class="co">## X30.39 0.06383135 0.07414142 0.04820027 0.07488303 0.02093370 0.03972425</span></span>
<span><span class="co">## X40.49 0.05820743 0.07612755 0.05306283 0.06779917 0.02360305 0.03029427</span></span>
<span><span class="co">## X50.59 0.05683002 0.06442917 0.04384439 0.05610186 0.01827245 0.03570696</span></span>
<span><span class="co">## X60.69 0.05350084 0.06973176 0.04353806 0.06650590 0.01837145 0.03673739</span></span>
<span><span class="co">## X70.79 0.07454396 0.08951194 0.04988014 0.07291749 0.02012949 0.03691629</span></span>
<span><span class="co">## X80.   0.07534391 0.09953593 0.06823541 0.08335971 0.02568176 0.03396271</span></span>
<span><span class="co">##                C7         C8</span></span>
<span><span class="co">## X18.19 0.04330875 0.03481014</span></span>
<span><span class="co">## X20.29 0.04117495 0.03439988</span></span>
<span><span class="co">## X30.39 0.04238655 0.02254512</span></span>
<span><span class="co">## X40.49 0.03336432 0.02715560</span></span>
<span><span class="co">## X50.59 0.03710602 0.01970179</span></span>
<span><span class="co">## X60.69 0.02908730 0.02419556</span></span>
<span><span class="co">## X70.79 0.03512425 0.02643359</span></span>
<span><span class="co">## X80.   0.03861481 0.02637523</span></span></code></pre>
<p>The standard deviations obtained in the district “Apoquindo” are
generally low. One reason for this is the high number of ballot boxes in
this district. In contrast, standard deviations of estimated
probabilities in districts with fewer ballot boxes, such as “Navidad”,
are larger.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">navidad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_XW_chile.html">get_XW_chile</a></span><span class="op">(</span>elect_district <span class="op">=</span> <span class="st">"NAVIDAD"</span><span class="op">)</span></span>
<span><span class="va">navidad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">navidad</span>, seed <span class="op">=</span> <span class="fl">42</span>, nboot <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">navidad</span><span class="op">$</span><span class="va">sd</span></span></code></pre></div>
<pre><code><span><span class="co">##               C1        C2        C3        C4         C5        C6        C7</span></span>
<span><span class="co">## X18.19 0.3173885 0.2775066 0.1758247 0.3748034 0.34252173 0.1862111 0.2113297</span></span>
<span><span class="co">## X20.29 0.2642999 0.2148970 0.2300379 0.1921584 0.13142429 0.1357480 0.2093558</span></span>
<span><span class="co">## X30.39 0.1826393 0.2645530 0.1969771 0.1785584 0.10809154 0.1603991 0.1382038</span></span>
<span><span class="co">## X40.49 0.1742081 0.1950356 0.1933681 0.1778562 0.08903065 0.1302125 0.1298807</span></span>
<span><span class="co">## X50.59 0.1594534 0.1807864 0.2090455 0.1662446 0.06817806 0.1209976 0.1123312</span></span>
<span><span class="co">## X60.69 0.1560145 0.1709638 0.2038837 0.1540343 0.07426099 0.1352429 0.1038013</span></span>
<span><span class="co">## X70.79 0.1898688 0.1680642 0.2561830 0.1724892 0.07986201 0.1698474 0.1198108</span></span>
<span><span class="co">## X80.   0.2066339 0.1956702 0.2523605 0.1869649 0.09635772 0.1522668 0.1824570</span></span>
<span><span class="co">##                C8</span></span>
<span><span class="co">## X18.19 0.14267125</span></span>
<span><span class="co">## X20.29 0.06989264</span></span>
<span><span class="co">## X30.39 0.08648556</span></span>
<span><span class="co">## X40.49 0.08894098</span></span>
<span><span class="co">## X50.59 0.09715487</span></span>
<span><span class="co">## X60.69 0.06181052</span></span>
<span><span class="co">## X70.79 0.07333803</span></span>
<span><span class="co">## X80.   0.15758501</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="reduce-estimation-error-using-group-aggregation">Reduce Estimation Error using Group Aggregation<a class="anchor" aria-label="anchor" href="#reduce-estimation-error-using-group-aggregation"></a>
</h2>
<p>Demographic groups can be merged to have probability estimates with
lower error. A greedy strategy that maximizes the variability of the
distribution of groups across ballot boxes is used, which ensures
standard deviations are below 5%. The package provides the following
function for the latter:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">navidad_proxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_agg_proxy.html">get_agg_proxy</a></span><span class="op">(</span><span class="va">navidad</span>, seed <span class="op">=</span> <span class="fl">42</span>, sd_threshold <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">navidad_proxy</span><span class="op">$</span><span class="va">group_agg</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2 3 4 5 6 7 8</span></span></code></pre>
<p>As shown in the output, the heuristic found a feasible configuration
by merging groups 1 with 2, 5 with 6, and 7 with 8. We can evaluate the
effectiveness of this grouping by comparing the mean standard deviation
to the original formulation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">navidad</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">navidad_proxy</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.02969188</span></span></code></pre>
<p>An exhaustive algorithm is also included in the package. It explores
all combinations of adjacent groups in order to maximize the
log-likelihood subject to having standard deviations below 2.5%. It
might require substantial computation time; therefore it is recommended
to use the most efficient method “mult”.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">navidad_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_agg_opt.html">get_agg_opt</a></span><span class="op">(</span><span class="va">navidad</span>, seed <span class="op">=</span> <span class="fl">42</span>, sd_threshold <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">navidad_opt</span><span class="op">$</span><span class="va">group_agg</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2 3 4 5 6 8</span></span></code></pre>
<p>The optimal group aggregation differs slightly from one obtained
before.</p>
</div>
<div class="section level2">
<h2 id="test-difference-between-estimates">Test difference between estimates<a class="anchor" aria-label="anchor" href="#test-difference-between-estimates"></a>
</h2>
<p>A relevant question is how significantly different are the
probability estimates of two sets of data, such as two different
districts. For instance, we can compare the results of the district
“APOQUINDO” and “PROVIDENCIA”, which belong to the same ward. A Welch’s
test can be applied to each component of the two probability matrix
estimates:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">providencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_XW_chile.html">get_XW_chile</a></span><span class="op">(</span>elect_district <span class="op">=</span> <span class="st">"PROVIDENCIA"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/welchtest.html">welchtest</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">providencia</span>,</span>
<span>    object2 <span class="op">=</span> <span class="va">apoquindo</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"mult"</span>,</span>
<span>    nboot <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">pvals</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           C1    C2    C3    C4    C5    C6    C7    C8</span></span>
<span><span class="co">## X18.19 0.000 0.963 0.115 0.000 0.353 0.467 0.337 0.951</span></span>
<span><span class="co">## X20.29 0.000 0.000 0.929 0.000 0.726 0.886 0.823 0.532</span></span>
<span><span class="co">## X30.39 0.000 0.000 0.001 0.000 0.233 0.325 0.630 0.943</span></span>
<span><span class="co">## X40.49 0.000 0.000 0.000 0.000 0.712 0.054 0.535 0.970</span></span>
<span><span class="co">## X50.59 0.145 0.001 0.000 0.006 0.008 0.237 0.643 0.066</span></span>
<span><span class="co">## X60.69 0.000 0.000 0.415 0.136 0.799 0.152 0.485 0.640</span></span>
<span><span class="co">## X70.79 0.116 0.084 0.981 0.035 0.679 0.262 0.373 0.339</span></span>
<span><span class="co">## X80.   0.921 0.162 0.002 0.029 0.249 0.262 0.977 0.341</span></span></code></pre>
<p>On the other side, it may be notable to see the difference between to
electoral districts whom voting tendencies are expected to be
different.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">la_granja</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_XW_chile.html">get_XW_chile</a></span><span class="op">(</span>elect_district <span class="op">=</span> <span class="st">"LA GRANJA"</span><span class="op">)</span></span>
<span><span class="va">lo_barnechea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_XW_chile.html">get_XW_chile</a></span><span class="op">(</span>elect_district <span class="op">=</span> <span class="st">"LO BARNECHEA"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/welchtest.html">welchtest</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">la_granja</span>,</span>
<span>    object2 <span class="op">=</span> <span class="va">lo_barnechea</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"mult"</span>,</span>
<span>    nboot <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">comparison2</span><span class="op">$</span><span class="va">pvals</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           C1    C2    C3    C4    C5    C6    C7    C8</span></span>
<span><span class="co">## X18.19 0.000 0.000 0.112 0.000 0.263 0.000 0.067 0.667</span></span>
<span><span class="co">## X20.29 0.000 0.000 0.361 0.000 0.008 0.000 0.000 0.921</span></span>
<span><span class="co">## X30.39 0.000 0.000 0.011 0.000 0.054 0.000 0.000 0.492</span></span>
<span><span class="co">## X40.49 0.000 0.000 0.000 0.000 0.023 0.000 0.000 0.199</span></span>
<span><span class="co">## X50.59 0.000 0.000 0.000 0.000 0.234 0.000 0.000 0.279</span></span>
<span><span class="co">## X60.69 0.000 0.000 0.000 0.000 0.227 0.000 0.858 0.305</span></span>
<span><span class="co">## X70.79 0.029 0.000 0.000 0.647 0.928 0.572 0.033 0.366</span></span>
<span><span class="co">## X80.   0.041 0.018 0.001 0.040 0.414 0.022 0.000 0.638</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="simulating-election-results">Simulating Election Results<a class="anchor" aria-label="anchor" href="#simulating-election-results"></a>
</h2>
<p>In this section, we simulate election data multiple times to evaluate
the accuracy and speed of each method on average.</p>
<p>We generate random elections with 2 groups, 2 candidates, and 50
ballots, and repeat each method <strong>10 times</strong> to calculate
their average performance.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Helper to repeat and average</span></span>
<span><span class="va">benchmark_method</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span>, <span class="va">...</span>, <span class="va">reps</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">maes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">reps</span><span class="op">)</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">reps</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">reps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_election.html">simulate_election</a></span><span class="op">(</span>num_groups <span class="op">=</span> <span class="fl">2</span>, num_candidates <span class="op">=</span> <span class="fl">2</span>, num_ballots <span class="op">=</span> <span class="fl">50</span>, seed <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>        <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eim.html">eim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">X</span>, <span class="va">samples</span><span class="op">$</span><span class="va">W</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_em.html">run_em</a></span><span class="op">(</span><span class="va">object</span>, method <span class="op">=</span> <span class="va">method_name</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">maes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">prob</span> <span class="op">-</span> <span class="va">samples</span><span class="op">$</span><span class="va">real_prob</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">time</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        avg_mae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">maes</span><span class="op">)</span>,</span>
<span>        avg_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="multinomial">Multinomial<a class="anchor" aria-label="anchor" href="#multinomial"></a>
</h3>
<p>The multinomial method offers a fast and simple approximation based
on the observed votes and prior probabilities. It is ideal for quick
estimates, with low computational cost and good overall accuracy for
moderately complex elections.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark_method</span><span class="op">(</span><span class="st">"mult"</span><span class="op">)</span></span>
<span><span class="va">multinomial_result</span></span></code></pre></div>
<pre><code><span><span class="co">## $avg_mae</span></span>
<span><span class="co">## [1] 0.008672613</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg_time</span></span>
<span><span class="co">## [1] 6.8e-05</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="multivariate-pdf">Multivariate PDF<a class="anchor" aria-label="anchor" href="#multivariate-pdf"></a>
</h3>
<p>The multivariate PDF method refines the multinomial approximation by
accounting for the local shape of the probability distribution.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multivariate_pdf_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark_method</span><span class="op">(</span><span class="st">"mvn_pdf"</span><span class="op">)</span></span>
<span><span class="va">multivariate_pdf_result</span></span></code></pre></div>
<pre><code><span><span class="co">## $avg_mae</span></span>
<span><span class="co">## [1] 0.008823992</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg_time</span></span>
<span><span class="co">## [1] 0.0017829</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="multivariate-cdf">Multivariate CDF<a class="anchor" aria-label="anchor" href="#multivariate-cdf"></a>
</h3>
<p>The multivariate CDF method approximates first and second moments of
the posterior by integrating over small regions of the multivariate
normal distribution. It provides better control over uncertainty at the
cost of higher computation, especially if a tight Monte Carlo error is
required.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multivariate_cdf_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark_method</span><span class="op">(</span><span class="st">"mvn_cdf"</span><span class="op">)</span></span>
<span><span class="va">multivariate_cdf_result</span></span></code></pre></div>
<pre><code><span><span class="co">## $avg_mae</span></span>
<span><span class="co">## [1] 0.008825618</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg_time</span></span>
<span><span class="co">## [1] 0.0019625</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="mcmc">MCMC<a class="anchor" aria-label="anchor" href="#mcmc"></a>
</h3>
<p>The MCMC method explores possible voting configurations by random
sampling, providing very flexible and accurate results. It typically
incurs an initial computational cost to generate valid samples, but
after reaching a sufficient number of samples, each additional iteration
becomes relatively fast and efficient.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark_method</span><span class="op">(</span><span class="st">"mcmc"</span>, samples <span class="op">=</span> <span class="fl">1000</span>, step_size <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">mcmc_result</span></span></code></pre></div>
<pre><code><span><span class="co">## $avg_mae</span></span>
<span><span class="co">## [1] 0.008222279</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg_time</span></span>
<span><span class="co">## [1] 1.206021</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="exact">Exact<a class="anchor" aria-label="anchor" href="#exact"></a>
</h3>
<p>The exact method computes all possible voting configurations
exhaustively. It guarantees the highest theoretical accuracy but becomes
quickly infeasible for elections with many candidates, groups, or
ballots due to its exponential computational complexity.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exact_result</span> <span class="op">&lt;-</span> <span class="fu">benchmark_method</span><span class="op">(</span><span class="st">"exact"</span><span class="op">)</span></span>
<span><span class="va">exact_result</span></span></code></pre></div>
<pre><code><span><span class="co">## $avg_mae</span></span>
<span><span class="co">## [1] 0.00832906</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $avg_time</span></span>
<span><span class="co">## [1] 0.0312628</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>fastei</p>
</div>

<div class="pkgdown-footer-right">
  <p>Developed by Daniel Hermosilla.</p>
</div>

    </footer>
</div>





  </body>
</html>
