grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group them by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the ages groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>%
group_by(LOCAL) %>%
mutate(Percent = Count / sum(Count) * 100) # Obtain percentage
# Stacked bar plot
ggplot(head(grouped_puente_alto_pct), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "fill") +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Age Group Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
head(grouped_puente_alto_pct)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group them by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the ages groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count")
grouped_puente_alto_pct
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group them by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) # Sum the ages groups
grouped_puente_alto
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE) / sum(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) * 100
)
)
grouped_puente_alto
grouped_puente_alto_pct
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(n = n()) %>%
mutate(Percentage = n / sum(n))
grouped_puente_alto_pct
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
ggplot(grouped_puente_alto_pct, aes(x = LOCAL)) +
geom_bar(aes(y = X18.19, fill = "18-19"), stat = "identity") +
geom_bar(aes(y = X20.29, fill = "20-29"), stat = "identity") +
geom_bar(aes(y = X30.39, fill = "30-39"), stat = "identity") +
geom_bar(aes(y = X40.49, fill = "40-49"), stat = "identity") +
geom_bar(aes(y = X50.59, fill = "50-59"), stat = "identity") +
geom_bar(aes(y = X60.69, fill = "60-69"), stat = "identity") +
geom_bar(aes(y = X70.79, fill = "70-79"), stat = "identity") +
geom_bar(aes(y = X80., fill = "80+"), stat = "identity") +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x-axis for readability
head(grouped_puente_alto_pct)
grouped_puente_alto_pct
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct), aes(x = LOCAL)) +
geom_bar(aes(y = X18.19, fill = "18-19"), stat = "identity") +
geom_bar(aes(y = X20.29, fill = "20-29"), stat = "identity") +
geom_bar(aes(y = X30.39, fill = "30-39"), stat = "identity") +
geom_bar(aes(y = X40.49, fill = "40-49"), stat = "identity") +
geom_bar(aes(y = X50.59, fill = "50-59"), stat = "identity") +
geom_bar(aes(y = X60.69, fill = "60-69"), stat = "identity") +
geom_bar(aes(y = X70.79, fill = "70-79"), stat = "identity") +
geom_bar(aes(y = X80., fill = "80+"), stat = "identity") +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct), aes(x = LOCAL)) +
geom_bar(aes(y = X18.19, fill = "18-19"), stat = "identity") +
geom_bar(aes(y = X20.29, fill = "20-29"), stat = "identity") +
geom_bar(aes(y = X30.39, fill = "30-39"), stat = "identity") +
geom_bar(aes(y = X40.49, fill = "40-49"), stat = "identity") +
geom_bar(aes(y = X50.59, fill = "50-59"), stat = "identity") +
geom_bar(aes(y = X60.69, fill = "60-69"), stat = "identity") +
geom_bar(aes(y = X70.79, fill = "70-79"), stat = "identity") +
geom_bar(aes(y = X80., fill = "80+"), stat = "identity") +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct), aes(x = LOCAL)) +
geom_bar(aes(y = X18.19, fill = "18-19"), stat = "identity") +
geom_bar(aes(y = X20.29, fill = "20-29"), stat = "identity") +
geom_bar(aes(y = X30.39, fill = "30-39"), stat = "identity") +
geom_bar(aes(y = X40.49, fill = "40-49"), stat = "identity") +
geom_bar(aes(y = X50.59, fill = "50-59"), stat = "identity") +
geom_bar(aes(y = X60.69, fill = "60-69"), stat = "identity") +
geom_bar(aes(y = X70.79, fill = "70-79"), stat = "identity") +
geom_bar(aes(y = X80., fill = "80+"), stat = "identity") +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct), aes(x = LOCAL, y = 100)) +
geom_bar(aes(y = X18.19, fill = "18-19"), stat = "identity", position = "fill") +
geom_bar(aes(y = X20.29, fill = "20-29"), stat = "identity", position = "fill") +
geom_bar(aes(y = X30.39, fill = "30-39"), stat = "identity", position = "fill") +
geom_bar(aes(y = X40.49, fill = "40-49"), stat = "identity", position = "fill") +
geom_bar(aes(y = X50.59, fill = "50-59"), stat = "identity", position = "fill") +
geom_bar(aes(y = X60.69, fill = "60-69"), stat = "identity", position = "fill") +
geom_bar(aes(y = X70.79, fill = "70-79"), stat = "identity", position = "fill") +
geom_bar(aes(y = X80., fill = "80+"), stat = "identity", position = "fill") +
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
grouped_puente_alto_pct
grouped_puente_alto_pct_long <- grouped_puente_alto_pct %>%
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Percent")
grouped_puente_alto_pct_long
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct_long), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct_long, 5 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 3)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct_long, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct_long, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Filter Puente Alto
group_by(LOCAL) %>% # Group by LOCAL
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE)
)
) %>%
mutate(across(where(is.numeric), \(x) x / rowSums(across(where(is.numeric))) * 100)) # Compute percentages
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct_long, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 3)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE) / sum(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) * 100
)
) %>%
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Percent") # Reshape for ggplot
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(
across(
where(is.numeric),
\(x) sum(x, na.rm = TRUE) / sum(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) * 100
)
) %>%
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Percent") # Reshape for ggplot
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by LOCAL",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>%  # Get Puente Alto apparitions
group_by(LOCAL) %>%  # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>%  # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>%  # Reshape for ggplot
group_by(LOCAL) %>%  # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100)  # Calculate the percentage distribution
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>% # Reshape for ggplot
group_by(LOCAL) %>% # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100) # Calculate the percentage distribution
# Plot using a stacked bar chart
# Stacked bar plot (CORRECTLY IMPLEMENTED)
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>% # Reshape for ggplot
group_by(LOCAL) %>% # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100) # Calculate the percentage distribution
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "LOCAL",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>% # Reshape for ggplot
group_by(LOCAL) %>% # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100) # Calculate the percentage distribution
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "Local",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5, family = "Times")) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>% # Reshape for ggplot
group_by(LOCAL) %>% # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100) # Calculate the percentage distribution
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "Local",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 5)) # Rotate x-axis for readability
library(ggplot2)
library(dplyr)
grouped_puente_alto_pct <- chile_groups_2021 %>%
filter(grepl("(?i)Puente Alto", CIRCUNSCRIPCION.ELECTORAL, perl = TRUE)) %>% # Get Puente Alto apparitions
group_by(LOCAL) %>% # Group by voting local
summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>% # Sum the age groups
pivot_longer(cols = -LOCAL, names_to = "Age_Group", values_to = "Count") %>% # Reshape for ggplot
group_by(LOCAL) %>% # Maintain group for percentage calculation
mutate(Percent = Count / sum(Count) * 100) # Calculate the percentage distribution
# Plot using a stacked bar chart
ggplot(head(grouped_puente_alto_pct, 7 * 8), aes(x = LOCAL, y = Percent, fill = Age_Group)) +
geom_bar(stat = "identity", position = "stack") + # "stack" to properly stack percentages
scale_y_continuous(labels = scales::percent_format(scale = 1)) +
labs(
title = "Age Group Percentage Distribution by the Voting Local",
x = "Local",
y = "Percentage",
fill = "Age Group"
) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 5)) # Rotate x-axis for readability
